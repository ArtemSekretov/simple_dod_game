meta:
 name: bullets_update
 size: uint16_t
 import:
  - collision_source_instances

constants:
 - name: source_bullets_max_instance_count
   value: 256
 - name: max_source_bullet_types_per_source_type
   value: 16
 - name: max_instances_per_wave
   value: 64

variables:
 - name: spawn_count
   types:
    - name: spawn_count
      type: uint32_t
 - name: instances_live
   types:
    - name: instances_live
      type: uint64_t
      count: (source_bullets_max_instance_count / 64)
 - name: instances_reset
   types:
    - name: instances_reset
      type: uint64_t
      count: (source_bullets_max_instance_count / 64)

sheets:
 - name: bullet_positions
   capacity: source_bullets_max_instance_count
   columns:
    - name: current_position
      sources:
       - name: current_position
         type: float
         count: 2
    - name: end_position
      sources:
       - name: end_position
         type: float
         count: 2
    - name: type_index
      sources:
       - name: type_index
         type: uint8_t
 - name: source_bullets
   capacity: max_instances_per_wave
   columns:
    - name: spawn_count
      sources:
       - name: spawn_count
         type: uint16_t
         count: max_source_bullet_types_per_source_type

context:
 - name: bullets_bin
   type: bullets
 - name: bullet_source_instances_bin
   type: bullet_source_instances
 - name: game_state_bin
   type: game_state
 - name: play_clock_bin
   type: play_clock
 - name: collision_instances_damage_bin
   type: collision_instances_damage

maps:
 - type: collision_source_instances
   variables:
    - source: instances_reset
      target: source_instances_reset
    - source: instances_live
      target: source_instances_enabled
   sheets:
    - source: bullet_positions
      target: source_instances
      columns:
       - source: type_index
         target: source_type_index
       - source: current_position
         target: positions